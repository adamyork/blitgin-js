
var Action,Bootstrap,CollisionEngine,Composite,Emitter,Enemy,EnemyGroup,Game,GameError,Group,Input,Keyboard,Map,MapObject,MapObjectGroup,Nis,NisCondition,NisGoal,Particle,PhysicsEngine,Player,Point,Rectangle,RenderEngine,RenderObject,SoundEngine,State,__hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child;};Action=(function(_super){__extends(Action,_super);function Action(){Action.__super__.constructor.apply(this,arguments);}
Action.prototype.contructor=function(name){this.name=name;};return Action;})(RenderObject);Bootstrap=(function(){var _classes,_collection;function Bootstrap(name){this.name=name;}
_classes=["Point","Rectangle","Keyboard","Game","GameError","Group","RenderObject","Action","RenderEngine","State","PhysicsEngine","CollisionEngine","SoundEngine","Input","Player","Map","MapObject","MapObjectGroup","Nis","NisCondition","NisGoal","Particle","PhysicsEngine","CollisionEngine","SoundEngine","Emitter","Enemy","EnemyGroup"];_collection=[];Bootstrap.prototype.start=function(callback,basePath){var clazz,_i,_len;for(_i=0,_len=_classes.length;_i<_len;_i++){clazz=_classes[_i];_collection[_i]=this.prepare(clazz,basePath);}
return this.load(callback);};Bootstrap.prototype.prepare=function(clazz,basePath){return basePath+clazz+".js";};Bootstrap.prototype.load=function(callback){return $LAB.script(_collection).wait(callback);};return Bootstrap;})();CollisionEngine=(function(){var _map,_physicsEngine,_player;function CollisionEngine(name){this.name=name;}
_map={};_player={};_physicsEngine={};CollisionEngine.prototype.manageCollisions=function(focus,target){var obj,tmpCollection,_i,_len;if(typeof focus===Action){tmpCollection=[];if(focus.owner===Action.PLAYER){tmpCollection=this.map.activeEnemies;}else{tmpCollection[0]=this.player;}
for(_i=0,_len=tmpCollection.length;_i<_len;_i++){obj=tmpCollection[_i];this.checkForCollision(obj,focus);}
return;}
return this.checkForCollision(focus,target);};CollisionEngine.prototype.checkForCollision=function(focus,target){var intersection;if(target.collisionRect.intersects(focus.collisionRect)){if(_physicsEngine.isTargetMovingVertically(target)){intersection=target.collisionRect.intersection(focus.collisionRect);this.physicsEngine.handleVerticalCollision(target,focus,intersection);}
if(target.direction===1&&!(type(focus===MapObject))){if(typeof target===Action){focus.state=focus.collisionLeft;focus.isBusy=true;}else{target.state=target.collisionRight;focus.state=focus.collisionLeft;target.isBusy=true;focus.isBusy=true;}
this.physicsEngine.handleHorizontalCollision(target,focus,this.map);}else if(target.direction===-1&&!(typeof focus===MapObject)){if(typeof target===Action){focus.state=focus.collisionRight;focus.isBusy=true;}else{target.state=target.collisionLeft;focus.state=focus.collisionRight;target.isBusy=true;focus.isBusy=true;}
this.physicsEngine.handleHorizontalCollision(target,focus,this.map);}
focus.health-=target.damage;return target.health-=focus.damage;}};CollisionEngine.prototype.checkVerticalMapCollision=function(target){var destination,horizontalMax,horizontalMin,i,outOfBounds,point,_ref,_ref2,_ref3,_ref4;outOfBounds=this.physicsEngine.isTargetOutOfBounds(target,this.map);if(outOfBounds||target.applyGravityAndFriction===false)return;destination=this.physicsEngine.getVerticalDestination(target,this.map);horizontalMin=this.physicsEngine.getHorizontalMin(target,this.map);horizontalMax=this.physicsEngine.getHorizontalMax(target,horizontalMin);i=0;point=0;if(target.direction===1){for(i=_ref=horizontalMin+target.thresholdX,_ref2=horizontalMax-target.thresholdX;_ref<=_ref2?i<=_ref2:i>=_ref2;_ref<=_ref2?i++:i--){this.checkForCieling(Math.round(i));point=this.map.collisionData.getPixel(Math.round(i),Math.round(destination));if(point!==0){checkForFloor(point,destination,i,target);return;}}}else{for(i=_ref3=horizontalMin-target.thresholdX,_ref4=horizontalMax+target.thresholdX;_ref3<=_ref4?i<=_ref4:i>=_ref4;_ref3<=_ref4?i++:i--){this.checkForCieling(Math.round(i));point=this.map.collisionData.getPixel(Math.round(i),Math.round(destination));if(point!==0){this.checkForFloor(point,destination,i,target);return;}}}
return this.physicsEngine.manageVerticalBounds(target,this.map);};CollisionEngine.prototype.checkHorizontalMapCollision=function(){var destination,i,point,verticalMax,verticalMin;destination=this.physicsEngine.getHorizontalDesitination(this.player,this.map);verticalMin=this.physicsEngine.getVerticalMin(this.player,this.map);verticalMax=this.physicsEngine.getVerticalMax(this.player,this.map);for(i=verticalMin;verticalMin<=verticalMax?i<=verticalMax:i>=verticalMax;verticalMin<=verticalMax?i++:i--){point=this.map.collisionData.getPixel(destination,Math.round(i));if(point!==0){while(point!==0){destination-=this.player.direction;point=this.map.collisionData.getPixel(destination,Math.round(i));}
if(this.player.direction===1)destination-=this.player.width;this.physicsEngine.manageHorizontalBounds(this.player,this.map,destination);return;}}};CollisionEngine.prototype.checkForFloor=function(point,destination,position,target){var count;count=0;while(point!==0){count++;destination--;point=this.map.collisionData.getPixel(Math.round(position),Math.round(destination));if(count>(target.height*.75)){point=0;return;}}
return this.physicsEngine.setTargetFloor(target,this.map,destination);};CollisionEngine.prototype.checkForCieling=function(point){var top;top=this.map.collisionData.getPixel(point,this.player.y);if(top!==0){while(top!==0){this.physicsEngine.incrementPlayerVelocity(this.player);top=_map.collisionData.getPixel(point,this.player.y);}
return this.physicsEngine.resetPlayerVelocity(this.player);}};return CollisionEngine;})();CollisionEngine.prototype.__defineGetter__("map",function(){return this._map;});CollisionEngine.prototype.__defineSetter__("map",function(val){return this._map=val;});CollisionEngine.prototype.__defineGetter__("player",function(){return this._player;});CollisionEngine.prototype.__defineSetter__("player",function(val){return this._player=val;});CollisionEngine.prototype.__defineGetter__("physicsEngine",function(){return this._physicsEngine;});CollisionEngine.prototype.__defineSetter__("physicsEngine",function(val){return this._physicsEngine=val;});Composite=(function(_super){var _frame;__extends(Composite,_super);function Composite(name){this.name=name;}
_frame=0;Composite.prototype.initialize=function(){var duration;Composite.__super__.initialize.apply(this,arguments);return duration=Math.ceil(this.asset.width/this.cellWidth);};return Composite;})(RenderObject);Composite.prototype.__defineGetter__("frame",function(){return this._frame;});Composite.prototype.__defineSetter__("frame",function(val){if(val>this.duration){this._frame=0;return;}
return this._frame=this._frame===0||val===0?val:val-this.frameBuffer;});Emitter=(function(){var _frame,_friction,_gravity,_particles,_quantity,_size,_type;function Emitter(_type,_gravity,_friction,_quantity,_size){this._type=_type;this._gravity=_gravity;this._friction=_friction;this._quantity=_quantity;this._size=_size;this.createParticles();}
_type={};_gravity=0;_friction=0;_quantity=0;_particles=[];_size=0;_frame=0;return Emitter;})();({createParticles:function(){var i,particle,_i,_len,_results;_results=[];for(_i=0,_len=_quantity.length;_i<_len;_i++){i=_quantity[_i];particle=new _type(i);_results.push(_particles.push(particle));}
return _results;},removeParticle:function(particle){return _particles.slice(particle.index,(particle.index+1));}});Emitter.prototype.__defineGetter__("frame",function(){return this._frame;});Emitter.prototype.__defineGetter__("frame",function(val){var particle,_i,_len,_ref,_results;_ref=this._particles;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){particle=_ref[_i];particle.frame++;particle.velocityX+=particle.easeCoefficient;particle.velocityY+=particle.easeCoefficient;particle.x=(particle.x+(particle.velocityX*particle.direction))-_friction;particle.y=(particle.y+particle.velocityY)+_gravity;if(particle.frame>=particle.lifeSpan){this.removeParticle(particle);continue;}else{_results.push(void 0);}}
return _results;});Emitter.prototype.__defineGetter__("bitmapData",function(){var bmpData,particle,_i,_len,_ref;bmpData=new Image();_ref=this._particles;for(_i=0,_len=_ref.length;_i<_len;_i++){particle=_ref[_i];particle;}
return bmpData;});Emitter.prototype.__defineGetter__("hasParticles",function(){if(this._particles.length!==0){return true;}else{return false;}});Emitter.prototype.__defineGetter__("rect",function(){return new Rectangle(0,0,this._size,this._size);});Enemy=(function(_super){__extends(Enemy,_super);function Enemy(name){this.name=name;}
Enemy.prototype.behavior=function(args){};return Enemy;})(Player);Enemy.prototype.__defineGetter__("x",function(){return this._screenX;});Enemy.prototype.__defineSetter__("x",function(val){return this._screenX=val;});Enemy.prototype.__defineGetter__("y",function(){return this._screenY;});Enemy.prototype.__defineSetter__("y",function(val){return this._screenY=val;});Enemy.prototype.__defineGetter__("collisionRect",function(){return new Rectangle(this.screenX+this.thresholdX,this.screenY+this.thresholdY,this.width-(this.thresholdX*2),this.height-(this.thresholdY*2));});Enemy.prototype.__defineGetter__("point",function(){return new Point(this.screenX,this.screenY);});Enemy.prototype.__defineSetter__("frame",function(val){this._frame=val;if(!isBusy)return this.behavior();});EnemyGroup=(function(_super){__extends(EnemyGroup,_super);function EnemyGroup(type,map,indep){this.type=type;this.map=map;this.indep=indep;}
return EnemyGroup;})(Group);Game=(function(){var _activeMap,_activePlayer,_animationFrameRequest,_collisionEngineClass,_customKey,_customKeys,_downKeys,_input,_instance,_jumpKeys,_leftKeys,_maps,_movement,_parent,_pause,_physicsEngineClass,_players,_renderEngine,_renderEngineClass,_rightKeys,_screen,_soundEngine,_subscribers,_timer,_upKeys;function Game(name){this.name=name;Game.prototype.instance=this;this.keyboard=new Keyboard();this.setAnimationFrameRequest;}
_subscribers=[];_pause=false;_activeMap=0;_activePlayer=0;_customKey=0;_players=[];_maps=[];_leftKeys=[];_rightKeys=[];_upKeys=[];_downKeys=[];_jumpKeys=[];_customKeys=[];_parent={};_screen={};_renderEngineClass={};_collisionEngineClass={};_physicsEngineClass={};_renderEngine={};_soundEngine={};_movement={};_input={};_timer={};_instance={};_animationFrameRequest={};Game.prototype.render=function(){if(this._pause)return;return _animationFrameRequest(_renderEngine.render(_input));};Game.prototype.setAnimationFrameRequest=function(){var w;w=window;return _animationFrameRequest=w.requestAnimationFrame||w.webkitRequestAnimationFrame||w.mozRequestAnimationFrame||w.oRequestAnimationFrame||w.msRequestAnimationFrame;};Game.prototype.start=function(){return _timer=setInterval(this.render.bind(this),80);};Game.prototype.preinitialize=function(parent,width,height){_parent=parent;Game.prototype.VIEWPORT_HEIGHT=height;Game.prototype.VIEWPORT_WIDTH=width;_screen=document.createElement("canvas");_screen.setAttribute("width",this.VIEWPORT_WIDTH);_screen.setAttribute("height",this.VIEWPORT_HEIGHT);_screen.setAttribute("tabIndex",0);document.body.appendChild(_screen);return this.initialize();};Game.prototype.initialize=function(){var map,player;if(!this.renderEngineClass){_renderEngine=new RenderEngine();}else{_renderEngine=new _renderEngineClass();}
if(!this.collisionEngineClass){_renderEngine.collisionEngine=new CollisionEngine();}else{_renderEngine.collisionEngine=new _collisionEngineClass();}
if(!this.physicsEngineClass){_renderEngine.physicsEngine=new PhysicsEngine();}else{_renderEngine.physicsEngine=new _physicsEngineClass();}
if(this.maps.length===0){console.log("Blitgin_as :: [ERROR] :: you need at least one map.");}
if(this.players.length===0){console.log("Blitgin_as :: [ERROR] :: you need at least one player.");}
_soundEngine=new SoundEngine();_renderEngine.soundEngine=_soundEngine;map=this.maps[_activeMap];player=this.players[_activePlayer];_renderEngine.scrn=_screen;_renderEngine.map=new map();_renderEngine.player=new player();_input=new Input();_input.direction=0;_input.jump=0;_input.jumpLock=false;_input.customKey=0;return this.addListeners();};Game.prototype.addListeners=function(){document.onkeydown=this.manageMovement.bind(this);document.onkeyup=this.manageMovement.bind(this);return _screen.focus();};Game.prototype.removeListeners=function(){document.onkeydown=void 0;return document.onkeyup=void 0;};Game.prototype.manageMovement=function(e){var key;if(_input.disabled)return;if(window.event){key=window.event.keyCode;}else{key=e.keyCode;}
if(e.type===Keyboard.prototype.KEY_UP){_input.direction=this.checkKey(this.leftKeys,key)?0:_input.direction;_input.direction=this.checkKey(this.rightKeys,key)?0:_input.direction;_input.vDirection=this.checkKey(this.upKeys,key)?0:_input.vDirection;_input.vDirection=this.checkKey(this.downKeys,key)?0:_input.vDirection;_input.jump=this.checkKey(this.jumpKeys,key)?0:_input.jump;_input.customKey=this.checkKey(this.customKeys,key)?0:_input.customKey;}else{_input.direction=this.checkKey(this.leftKeys,key)?-1:_input.direction;_input.direction=this.checkKey(this.rightKeys,key)?1:_input.direction;_input.vDirection=this.checkKey(this.upKeys,key)?-1:_input.direction;_input.vDirection=this.checkKey(this.downKeys,key)?1:_input.direction;_input.jump=this.checkKey(this.jumpKeys,key)?1:_input.jump;}
if(this.checkKey(_customKeys,key)){return _input.customKey=_customKeys[_customKey];}};Game.prototype.checkKey=function(arr,keyCode){var index;if(!arr)return;index=arr.indexOf(keyCode,0);_customKey=index;return index!==-1;};Game.prototype.dispose=function(){removeListeners();this.players=void 0;this.maps=void 0;this.leftKeys=void 0;this.rightKeys=void 0;this.upKeys=void 0;this.downKeys=void 0;this.jumpKeys=void 0;this.customKeys=void 0;this.renderEngineClass=void 0;this.renderEngine.dispose();_soundEngine=void 0;_movement=void 0;_input=void 0;_subscribers=void 0;return _screen=void 0;};Game.prototype.notifySubscribers=function(map,player,actions){var subscriber,_i,_len,_results;_results=[];for(_i=0,_len=_subscribers.length;_i<_len;_i++){subscriber=_subscribers[_i];_results.push(subscriber.notify(map,player,actions));}
return _results;};Game.prototype.subscribe=function(subscriber){return _subscribers.push(subscriber);};Game.prototype.unsubscribe=function(subscriber){return _subscribers.slice(_subscribers.indexOf(subscriber),_subscribers.indexOf(subscriber)+1||9e9);};return Game;})();Game.prototype.__defineGetter__("instance",function(){return this._instance;});Game.prototype.__defineSetter__("instance",function(val){return this._instance=val;});Game.prototype.__defineGetter__("renderEngineClass",function(){return this._renderEngineClass;});Game.prototype.__defineSetter__("renderEngineClass",function(val){return this._renderEngineClass=val;});Game.prototype.__defineGetter__("collisionEngineClass",function(){return this._collisionEngineClass;});Game.prototype.__defineSetter__("collisionEngineClass",function(val){return this._collisionEngineClass=val;});Game.prototype.__defineGetter__("physicsEngineClass",function(){return this._physicsEngineClass;});Game.prototype.__defineSetter__("physicsEngineClass",function(val){return this._physicsEngineClass=val;});Game.prototype.__defineGetter__("players",function(){return this._players;});Game.prototype.__defineSetter__("players",function(val){return this._players=val;});Game.prototype.__defineGetter__("maps",function(){return this._maps;});Game.prototype.__defineSetter__("maps",function(val){return this._maps=val;});Game.prototype.__defineGetter__("activeMap",function(){return this._activeMap;});Game.prototype.__defineSetter__("activeMap",function(val){return this._activeMap=val;});Game.prototype.__defineSetter__("activePlayer",function(val){return this._activePlayer=val;});Game.prototype.__defineGetter__("activePlayer",function(){return this._activePlayer;});Game.prototype.__defineGetter__("leftKeys",function(){return this._leftKeys;});Game.prototype.__defineSetter__("leftKeys",function(val){return this._leftKeys=val;});Game.prototype.__defineGetter__("rightKeys",function(){return this._rightKeys;});Game.prototype.__defineSetter__("rightKeys",function(val){return this._rightKeys=val;});Game.prototype.__defineGetter__("upKeys",function(){return this._upKeys;});Game.prototype.__defineSetter__("upKeys",function(val){return this._upKeys=val;});Game.prototype.__defineGetter__("downKeys",function(){return this._downKeys;});Game.prototype.__defineSetter__("downKeys",function(val){return this._downKeys=val;});Game.prototype.__defineGetter__("jumpKeys",function(){return this._jumpKeys;});Game.prototype.__defineSetter__("jumpKeys",function(val){return this._jumpKeys=val;});Game.prototype.__defineGetter__("customKeys",function(){return this._customKeys;});Game.prototype.__defineSetter__("customKeys",function(val){return this._customKeys=val;});Game.prototype.__defineGetter__("pause",function(){return this._pause;});Game.prototype.__defineSetter__("pause",function(val){return this._pause=val;});Game.prototype.__defineGetter__("keyboard",function(){return this._keyboard;});Game.prototype.__defineSetter__("keyboard",function(val){return this._keyboard=val;});GameError=(function(){function GameError(name){this.name=name;}
GameError.prototype.warnNotUsed=function(clazz,func){return logger.warn("WARNING :: "+func+"  is not used by "+clazz+". Stack is ");};return GameError;})();Group=(function(){var _independence,_positions,_type;function Group(name){this.name=name;}
_type="";_positions=[];_independence=0;return Group;})();Game.prototype.__defineGetter__("type",function(){return this._type;});Game.prototype.__defineSetter__("type",function(val){return this._type=val;});Game.prototype.__defineGetter__("positions",function(){return this._positions;});Game.prototype.__defineSetter__("positions",function(val){return this._positions=val;});Game.prototype.__defineGetter__("independence",function(){return this._independence;});Game.prototype.__defineSetter__("independence",function(val){return this._independence=val;});Input=(function(){function Input(name){this.name=name;}
return Input;})();Keyboard=(function(){function Keyboard(name){this.name=name;}
return Keyboard;})();Keyboard.prototype.KEY_UP="keyup";Keyboard.prototype.KEY_DOWN="keydown";Keyboard.prototype.LEFT=65;Keyboard.prototype.RIGHT=68;Keyboard.prototype.SPACE=32;Map=(function(_super){var _activeEnemies,_activeMapObjects,_assetsLoaded,_backgroundAsset,_backgroundAssetClass,_backgroundData,_collisionAsset,_collisionAssetClass,_collisionData,_enemies,_foregroundAsset,_foregroundAssetClass,_foregroundData,_friction,_gravity,_inactiveEnemies,_inactiveMapObjects,_initializeComplete,_mapObjects,_midgroundAsset,_midgroundAssetClass,_midgroundData,_nis,_paralaxing,_platform,_showCollisionMap,_sound,_soundLoops;__extends(Map,_super);function Map(name){this.name=name;}
_paralaxing=false;_platform=false;_showCollisionMap=false;_assetsLoaded=0;_initializeComplete=false;_gravity=10;_friction=.25;_enemies=[];_mapObjects=[];_nis=[];_activeEnemies=[];_inactiveEnemies=[];_activeMapObjects=[];_inactiveMapObjects=[];_backgroundAssetClass={};_midgroundAssetClass={};_foregroundAssetClass={};_collisionAssetClass={};_backgroundAsset={};_midgroundAsset={};_foregroundAsset={};_collisionAsset={};_backgroundData={};_midgroundData={};_foregroundData={};_collisionData={};_sound={};_soundLoops=0;Map.prototype.initialize=function(){this.workbench=document.createElement("canvas");if(this.paralaxing){if(void 0!==this.backgroundAssetClass&&void 0!==this.midgroundAssetClass&&void 0!==this.foregroundAssetClass&&void 0!==this.collisionAssetClass&&void 0!==this.enemies&&void 0!==this.mapObjects){return this.initializeAssets();}else{return console.log("Maps using paraxling require 3 assets and a collection of enemies.");}}else{if(void 0!==this.foregroundAssetClass&&void 0!==this.enemies&&void 0!==this.collisionAssetClass){return this.initializeAssets();}else{return console.log("Maps require a foreground , collision asset , and a collection of enemies.");}}};Map.prototype.initializeAssets=function(){if(this.paralaxing){this.backgroundAsset=new Image();this.backgroundAsset.onload=this.imageLoadComplete.bind(this);this.backgroundAsset.src=this.backgroundAssetClass;this.backgroundData=new Image();this.midgroundAsset=new Image();this.midgroundAsset.onload=this.imageLoadComplete.bind(this);this.midgroundAsset.src=this.backgroundAssetClass;this.midgroundData=new Image();}
this.foregroundAsset=new Image();this.foregroundAsset.onload=this.imageLoadComplete.bind(this);this.foregroundAsset.src=this.foregroundAssetClass;this.collisionAsset=new Image();this.collisionAsset.onload=this.imageLoadComplete.bind(this);this.collisionAsset.src=this.collisionAssetClass;this.foregroundData=new Image();return this.collisionData=new Image();};Map.prototype.imageLoadComplete=function(e){_assetsLoaded++;if(this.paralaxing){if(_assetsLoaded===Map.prototype.TOTAL_PARALAX_ASSETS){this.removeBlackAndCache(this.backgroundAsset,this.backgroundData);this.removeBlackAndCache(this.midgroundAsset,this.midgroundData);this.removeBlackAndCache(this.foregroundAsset,this.foregroundData);this.removeBlackAndCache(this.collisionAsset,this.collisionData);return this.finalize();}}else{if(_assetsLoaded===Map.prototype.TOTAL_STANDARD_ASSETS){this.removeBlackAndCache(this.foregroundAsset,this.foregroundData);this.removeBlackAndCache(this.collisionAsset,this.collisionData);return this.finalize();}}};Map.prototype.finalize=function(){this._initializeComplete=true;this.x=0;this.y=0;this.activeEnemies=[];return this.activeMapObjects=[];};Map.prototype.removeBlackAndCache=function(asset,targetData){var a,b,ctx,g,imageData,index,r,xpos,ypos,_ref,_ref2;this.workbench.width=asset.width;this.workbench.height=asset.height;ctx=this.workbench.getContext('2d');ctx.drawImage(asset,0,0);imageData=ctx.getImageData(0,0,this.workbench.width,this.workbench.height);for(xpos=0,_ref=imageData.width-1;0<=_ref?xpos<=_ref:xpos>=_ref;0<=_ref?xpos++:xpos--){for(ypos=0,_ref2=imageData.height-1;0<=_ref2?ypos<=_ref2:ypos>=_ref2;0<=_ref2?ypos++:ypos--){index=4*(ypos*imageData.width+xpos);r=imageData.data[index];g=imageData.data[index+1];b=imageData.data[index+2];a=imageData.data[index+3];if(r+g+b===0)imageData.data[index+3]=0;}}
ctx.putImageData(imageData,0,0);targetData.src=null;targetData.src=this.workbench.toDataURL();return ctx.clearRect(0,0,asset.width,asset.height);};Map.prototype.manageElements=function(type){var activeTargets,enemy,group,i,inactiveTargets,indep,key,obj,posX,posY,target,targetArray,vh,vw,_i,_j,_len,_len2,_ref;targetArray=type===Map.prototype.MANAGE_ENEMIES?this.enemies:this.mapObjects;inactiveTargets=type===Map.prototype.MANAGE_ENEMIES?_inactiveEnemies:_inactiveMapObjects;activeTargets=type===Map.prototype.MANAGE_ENEMIES?_activeEnemies:_activeMapObjects;for(_i=0,_len=targetArray.length;_i<_len;_i++){group=targetArray[_i];_ref=group.positions;for(_j=0,_len2=_ref.length;_j<_len2;_j++){i=_ref[_j];key=this.generateKey(group,i);target=activeTargets[key];obj={};posX=target?target.mapX:group.positions[i].x;posY=target?target.mapY:group.positions[i].y;vw=Game.prototype.VIEWPORT_WIDTH;vh=Game.prototype.VIEWPORT_HEIGHT;if(inactiveTargets[posX+posY])return;indep=group.independence;if(target===void 0){if(this.sEnemyOnScreen(posX,posY,vw,vh,indep)){enemy=group.type;obj=new enemy();obj.mapX=posX;obj.mapY=posY;obj.screenX=posX-x;obj.screenY=obj.mapY-y-gravity;obj.uniqueID=key;activeTargets[obj.uniqueID]=obj;}}else if(target){if(!this.isEnemyOnScreen(posX,posY,vw,vh,indep||target.isDead)){delete activeTargets[target.uniqueID];}
if(target.isDead)inactiveTargets[target.uniqueID]=true;}}}};Map.prototype.generateKey=function(group,i){return group.type+""+group.positions[i].x+""+group.positions[i].y+""+i;};Map.prototype.isEnemyOnScreen=function(posX,posY,vw,vh,indep){var hBounds,vBounds;hBounds=(((posX-indep)-x)-vw)<=0&&(((posX+indep)-x)-vw)>=-vw;vBounds=(((posY+indep)-y)-vh)<=0&&(((posY-indep)-y)-vh)>=-vh;return hBounds&&vBounds;};Map.prototype.checkForNIS=function(player){var nis,_i,_len;if(player===void 0)return;for(_i=0,_len=_nis.length;_i<_len;_i++){nis=_nis[_i];nis.player=player;nis.enemies=[];nis.map=this;if(nis.conditionsMet)return nis;}};Map.prototype.removeNis=function(nis){var arr,index;index=_nis.indexOf(nis,0);arr=_nis.splice(index,1);return arr=void 0;};Map.prototype.dispose=function(){this.backgroundAssetClass=void 0;this.midgroundAssetClass=void 0;this.foregroundAssetClass=void 0;this.backgroundAsset=void 0;this.midgroundAsset=void 0;this.foregroundAsset=void 0;this.midgroundData=void 0;this.foregroundData=void 0;_enemies=void 0;_mapObjects=void 0;_activeEnemies=void 0;_inactiveEnemies=void 0;_activeMapObjects=void 0;return _inactiveMapObjects=void 0;};Map.prototype.copyPixels=function(asset,rect){var ctx,imageData;if(this.workbench.width<asset.width)this.workbench.width=asset.width;if(this.workbench.height<asset.height)this.workbench.height=asset.height;ctx=this.workbench.getContext('2d');ctx.drawImage(asset,0,0);imageData=ctx.getImageData(rect.x,rect.y,rect.width,rect.height);return ctx.putImageData(imageData,0,0);};return Map;})(RenderObject);Map.prototype.__defineGetter__("bitmapData",function(){var ctx,vh,vw,yPos;if(this._initializeComplete){ctx=this.workbench.getContext('2d');ctx.clearRect(0,0,this.workbench.width,this.workbench.height);yPos=this.platform?this._y:0;vh=Game.prototype.VIEWPORT_HEIGHT;vw=Game.prototype.VIEWPORT_WIDTH;if(this.paralaxing){this.copyPixels(this.backgroundData,tmp,new Rectangle(this._x*.25,yPos,vw,vh));this.copyPixels(this.midgroundData,tmp,new Rectangle(this._x*.5,yPos,vw,vh));}else{this.copyPixels(this.foregroundData,new Rectangle(this._x,yPos,vw,vh));}
if(this.showCollisionMap){this.copyPixels(this.collisionData,new Rectangle(this._x,yPos,vw,vh));}
return ctx.getImageData(0,0,Game.prototype.VIEWPORT_WIDTH,Game.prototype.ViewportHeight);}else{return console.log('You cannot start the game yet. Map assets are not loaded.');}});Map.prototype.__defineSetter__("x",function(val){if((val>=0)&&(val<=this.foregroundAsset.width-Game.prototype.VIEWPORT_WIDTH)){return this._x=val;}else if(val<0){return this._x=0;}else if(val>0){return this._x=this.foregroundAsset.width-Game.prototype.VIEWPORT_WIDTH;}});Map.prototype.__defineSetter__("y",function(val){if(val>=this.collisionData.height-Game.prototype.VIEWPORT_WIDTH){this._y=this.collisionData.height-Game.prototype.VIEWPORT_HEIGHT;return;}
if(val<0){this._y=0;return;}
return this._y=val;});Map.prototype.__defineSetter__("backgroundAssetClass",function(val){return this._backgroundAssetClass=val;});Map.prototype.__defineGetter__("backgroundAssetClass",function(){return this._backgroundAssetClass;});Map.prototype.__defineSetter__("midgroundAssetClass",function(val){return this._midgroundAssetClass=val;});Map.prototype.__defineGetter__("midgroundAssetClass",function(){return this._midgroundAssetClass;});Map.prototype.__defineSetter__("foregroundAssetClass",function(val){return this._foregroundAssetClass=val;});Map.prototype.__defineGetter__("foregroundAssetClass",function(){return this._foregroundAssetClass;});Map.prototype.__defineSetter__("collisionAssetClass",function(val){return this._collisionAssetClass=val;});Map.prototype.__defineGetter__("collisionAssetClass",function(){return this._collisionAssetClass;});Map.prototype.__defineSetter__("backgroundAsset",function(val){return this._backgroundAsset=val;});Map.prototype.__defineGetter__("backgroundAsset",function(){return this._backgroundAsset;});Map.prototype.__defineSetter__("midgroundAsset",function(val){return this._midgroundAsset=val;});Map.prototype.__defineGetter__("midgroundAsset",function(){return this._midgroundAsset;});Map.prototype.__defineSetter__("foregroundAsset",function(val){return this._foregroundAsset=val;});Map.prototype.__defineGetter__("foregroundAsset",function(){return this._foregroundAsset;});Map.prototype.__defineSetter__("collisionAsset",function(val){return this._collisionAsset=val;});Map.prototype.__defineGetter__("collisionAsset",function(){return this._collisionAsset;});Map.prototype.__defineSetter__("paralaxing",function(val){return this._paralaxing=val;});Map.prototype.__defineGetter__("paralaxing",function(){return this._paralaxing;});Map.prototype.__defineSetter__("showCollisionMap",function(val){return this._showCollisionMap=val;});Map.prototype.__defineGetter__("showCollisionMap",function(){return this._showCollisionMap;});Map.prototype.__defineSetter__("platform",function(val){return this._platform=val;});Map.prototype.__defineGetter__("platform",function(){return this._platform;});Map.prototype.__defineSetter__("enemies",function(val){return this._enemies=val;});Map.prototype.__defineGetter__("enemies",function(){return this._enemies;});Map.prototype.__defineGetter__("nis",function(){return this._nis;});Map.prototype.__defineSetter__("nis",function(val){return this._nis=val;});Map.prototype.__defineSetter__("mapObjects",function(val){return this._mapObjects=val;});Map.prototype.__defineGetter__("mapObjects",function(){return this._mapObjects;});Map.prototype.__defineSetter__("activeMapObjects",function(val){return this._activeMapObjects=val;});Map.prototype.__defineGetter__("activeMapObjects",function(){return this._activeMapObjects;});Map.prototype.__defineGetter__("activeEnemies",function(){return this._activeEnemies;});Map.prototype.__defineSetter__("activeEnemies",function(val){return this._activeEnemies=val;});Map.prototype.__defineGetter__("width",function(){return this._foregroundAsset.width;});Map.prototype.__defineGetter__("collisionData",function(){return this._collisionData;});Map.prototype.__defineSetter__("collisionData",function(val){return this._collisionData=val;});Map.prototype.__defineGetter__("foregroundData",function(){return this._foregroundData;});Map.prototype.__defineSetter__("foregroundData",function(val){return this._foregroundData=val;});Map.prototype.__defineSetter__("gravity",function(val){return this._gravity=val;});Map.prototype.__defineGetter__("gravity",function(){return this._gravity;});Map.prototype.__defineSetter__("friction",function(val){return this._friction=val;});Map.prototype.__defineGetter__("friction",function(){return this._friction;});Map.prototype.__defineGetter__("rect",function(){return new Rectangle(0,0,Game.prototype.VIEWPORT_WIDTH,Game.prototype.VIEWPORT_HEIGHT);});Map.prototype.__defineGetter__("point",function(){return new Point(0,0);});Map.prototype.__defineGetter__("sound",function(){return this._sound;});Map.prototype.__defineSetter__("sound",function(val){return this._sound=val;});Map.prototype.__defineGetter__("soundLoops",function(){return this._soundLoops;});Map.prototype.__defineSetter__("soundLoops",function(val){return this._soundLoops=val;});Map.prototype.MANAGE_ENEMIES="manageEnemies";Map.prototype.MANAGE_MAP_OBJECTS="manageMapObjects";Map.prototype.TOTAL_STANDARD_ASSETS=2;Map.prototype.TOTAL_PARALAX_ASSETS=4;MapObject=(function(_super){__extends(MapObject,_super);function MapObject(name){this.name=name;}
MapObject.prototype.behavior=function(){};return MapObject;})(Player);MapObject.prototype.__defineGetter__("x",function(){return this.screenX;});MapObject.prototype.__defineSetter__("x",function(val){return this.screenX=val;});MapObject.prototype.__defineGetter__("y",function(){return this.screenY;});MapObject.prototype.__defineSetter__("y",function(val){return this.screenY=val;});MapObject.prototype.__defineGetter__("collisionRect",function(){return new Rectangle(this.screenX+this.thresholdX,this.screenY+this.thresholdY,this.width-(this.thresholdX*2),this.height-(this.thresholdY*2));});MapObject.prototype.__defineGetter__("point",function(){return new Point(this.screenX,this.screenY);});MapObject.prototype.__defineSetter__("frame",function(val){this._frame=value;if(!this.isBusy)return this.behavior();});MapObjectGroup=(function(_super){__extends(MapObjectGroup,_super);function MapObjectGroup(type,position,independence){this.type=type;this.position=position;this.independence=independence;}
return MapObjectGroup;})(Group);Nis=(function(){var _enemies,_frame,_map,_nisCondition,_nisGoal,_player;function Nis(name){this.name=name;}
_nisCondition={};_nisGoal={};_player={};_map={};_enemies={};_frame=0;Nis.prototype.checkConditions=function(target,condition){var prop,value,_i,_len;for(_i=0,_len=condition.length;_i<_len;_i++){prop=condition[_i];value=condition[prop];return this.evaluatePropAndValue(target,prop,value);}
return true;};Nis.prototype.evaluatePropAndValue=function(target,prop,value){if(typeof value==="boolean"||typeof value==="string"){return target[prop]===value;}
if(typeof value==="number")return target[prop]>=value;if(typeof value==="object")return target[prop]===value;return false;};Nis.prototype.checkForEnemyConditions=function(){return this.enemies.length===this.nisCondition.enemies.length;};return Nis;})();Nis.prototype.__defineGetter__("conditionsMet",function(val){var Boolean;({pCondition:Boolean=checkConditions(this._player,this.nisCondition.playerCondition),mCondition:Boolean=checkConditions(this._map,this.nisCondition.mapCondition),eCondition:Boolean=this.checkForEnemyConditions()});return pCondition&&mCondition&&eCondition;});Nis.prototype.__defineGetter__("nisCondition",function(){return this._nisCondition;});Nis.prototype.__defineSetter__("nisCondition",function(val){return this._nisCondition=val;});Nis.prototype.__defineGetter__("nisGoal",function(){return this._nisGoal;});Nis.prototype.__defineSetter__("nisGoal",function(val){return this._nisGoal=val;});Nis.prototype.__defineGetter__("map()",function(){return this._map;});Nis.prototype.__defineSetter__("map",function(val){return this._map=val;});Nis.prototype.__defineGetter__("player",function(){return this._player;});Nis.prototype.__defineSetter__("player",function(val){return this._player=val;});Nis.prototype.__defineGetter__("enemies",function(){return this._enemies;});Nis.prototype.__defineSetter__("enemies",function(val){return this._enemies=val;});Nis.prototype.__defineGetter__("frame",function(){return this._frame;});Nis.prototype.__defineSetter__("frame",function(val){return this._frame=val;});NisCondition=(function(){var _enemies,_mapCondition,_playerCondition;function NisCondition(name){this.name=name;}
_mapCondition={};_playerCondition={};_enemies=[];return NisCondition;})();NisCondition.prototype.__defineGetter__("mapCondition",function(){return this._mapCondition;});NisCondition.prototype.__defineSetter__("mapCondition",function(val){return this._mapCondition=val;});NisCondition.prototype.__defineGetter__("playerCondition",function(){return this._playerCondition;});NisCondition.prototype.__defineSetter__("playerCondition",function(val){return this._playerCondition=val;});NisCondition.prototype.__defineGetter__("enemies",function(){return this._enemies;});NisCondition.prototype.__defineSetter__("enemies",function(val){return this._enemies=val;});NisGoal=(function(){var _duration,_enemyGoals,_mapGoals,_playerGoals;function NisGoal(name){this.name=name;}
_duration=0;_playerGoals={};_mapGoals={};_enemyGoals={};return NisGoal;})();NisGoal.prototype.__defineSetter__("duration",function(val){return this._duration=val;});NisGoal.prototype.__defineGetter__("duration",function(){return this._duration;});NisGoal.prototype.__defineSetter__("playerGoals",function(val){return this._playerGoals=val;});NisGoal.prototype.__defineGetter__("playerGoals",function(){return this._playerGoals;});NisGoal.prototype.__defineSetter__("mapGoals",function(val){return this._mapGoals=val;});NisGoal.prototype.__defineGetter__("mapGoals",function(){return this._mapGoals;});NisGoal.prototype.__defineSetter__("enemyGoals",function(val){return this._enemyGoals=val;});NisGoal.prototype.__defineGetter__("enemyGoals",function(){return this._enemyGoals;});Particle=(function(_super){var _index,_lifeSpan;__extends(Particle,_super);function Particle(index,x,y){this.index=index;this.x=x;this.y=y;}
_index=0;_lifeSpan=0;Particle.prototype.initialize=function(){var duration;Particle.__super__.initialize.apply(this,arguments);return duration=Math.ceil(this.asset.width/this.cellWidth);};return Particle;})(RenderObject);Particle.prototype.__defineGetter__("index",function(){return this._index;});Particle.prototype.__defineSetter__("index",function(value){return this._index=val;});Particle.prototype.__defineGetter__("lifeSpan",function(){return this._lifeSpan;});Particle.prototype.__defineSetter__("lifeSpan",function(value){return this._lifeSpan=val;});PhysicsEngine=(function(){var _friction,_gravity;function PhysicsEngine(name){this.name=name;}
_gravity=0;_friction=0;PhysicsEngine.prototype.adjustPlayerVerically=function(player,map){player.y-=player.velocityY;map.y-=player.velocityY;player.velocityY--;player.y+=map.gravity;return map.y+=map.gravity;};PhysicsEngine.prototype.applyPlayerInput=function(player,input){if(player.direction!==input.direction){player.velocityX=player.velocityX*(player.easeCoefficient/100);}
player.direction=input.direction;return player.velocityX+=player.easeCoefficient;};PhysicsEngine.prototype.adjustPlayerHorizontally=function(player,map){player.x=player.x+(player.velocityX*player.direction);player.velocityX-=map.friction;if(this.doesMapNeedToMove(player,map)){map.x=map.x+(player.velocityX*player.direction);return this.enforcePositionThreshold(player);}};PhysicsEngine.prototype.doesMapNeedToMove=function(player,map){var conditionLeft,conditionRight;conditionLeft=(player.x<=player.mapBoundsMin)&&(map.x!==0);conditionRight=(player.x>=player.mapBoundsMax)&&(map.x!==map.width-Game.prototype.VIEWPORT_WIDTH);return conditionLeft||conditionRight;};PhysicsEngine.prototype.enforcePositionThreshold=function(player){if(player.x<=player.mapBoundsMin){player.x=player.mapBoundsMin;return;}
return player.x=player.mapBoundsMax;};PhysicsEngine.prototype.isTargetMovingVertically=function(target){return target.velocityY!==0;};PhysicsEngine.prototype.handleVerticalCollision=function(target,focus,intersection){if(target.collisionRect.y>intersection.y)target.velocityY=0;if(target.collisionRect.y<intersection.y){return target.velocityY=target.maxVelocityY;}};PhysicsEngine.prototype.handleHorizontalCollision=function(target,focus,map){if(target.direction===1){if(target===Action){focus.x+=focus.width*focus.collisionCoefficient;focus.velocityX=0;}else{focus.screenX+=focus.width+target.width;target.x-=target.width*target.collisionCoefficient;map.x-=target.width*target.collisionCoefficient;target.velocityX=0;}}else if(target.direction===-1){if(typeof target===Action){focus.x-=focus.width*focus.collisionCoefficient;focus.velocityX=0;}else{target.screenX-=focus.width+target.width;target.x+=target.width*target.collisionCoefficient;map.x+=target.width*target.collisionCoefficient;target.velocityX=0;}}
return this.updateMapXIfEnemy(focus,target,target.direction);};PhysicsEngine.prototype.updateMapXIfEnemy=function(focus,target,direction){if(typeof focus===Enemy){return focus.mapX+=(focus.width+target.width)*direction;}};PhysicsEngine.prototype.isTargetOutOfBounds=function(target,map){return target.y-target.velocityY+map.gravity<target.y;};PhysicsEngine.prototype.getVerticalDestination=function(target,map){return target.y+target.height+map.y;};PhysicsEngine.prototype.getHorizontalMin=function(target,map){return target.vOrigin+map.x;};PhysicsEngine.prototype.getHorizontalMax=function(target,min){return min+(target.width*target.direction);};PhysicsEngine.prototype.manageVerticalBounds=function(target,map){if(target.y<0&&map.platform===false)return target.y=0;};PhysicsEngine.prototype.getHorizontalDesitination=function(player,map){return player.hOrigin+map.x-(player.thresholdX*player.direction);};PhysicsEngine.prototype.getVerticalMin=function(player,map){return player.y+map.y;};PhysicsEngine.prototype.getVerticalMax=function(player,map){return player.y+player.height+map.y;};PhysicsEngine.prototype.manageHorizontalBounds=function(player,map,destination){player.x=destination-map.x+(player.thresholdX*player.direction);return player.velocityX=0;};PhysicsEngine.prototype.setTargetFloor=function(target,map,destination){target.floor=destination-target.height-map.y;target.y=target.floor;return target.velocityY=0;};PhysicsEngine.prototype.resetPlayerVelocity=function(player){return player.velocityY=0;};PhysicsEngine.prototype.incrementPlayerVelocity=function(player){return player.y++;};PhysicsEngine.prototype.adjustMapVerically=function(map,player){if(player.y<0&&map.platform){map.y+=player.y;return player.y=0;}};PhysicsEngine.prototype.adjustEnemy=function(enemy,player,map){if(enemy.applyGravityAndFriction){if(this.doesMapNeedToMove(player,map)){enemy.screenX=enemy.screenX+(player.velocityX*-player.direction);}
enemy.screenY+=map.gravity;enemy.screenX=enemy.screenX+(enemy.velocityX*enemy.direction);return enemy.velocityX-=map.friction;}else{enemy.screenX=enemy.mapX-map.x;return enemy.screenY=enemy.mapY-map.y;}};PhysicsEngine.prototype.adjustAction=function(action,map){action.velocityX+=action.easeCoefficient;action.x+=action.direction*action.velocityX;action.y+=map.gravity-(action.velocityX*.5);return action.velocityX-=map.friction;};PhysicsEngine.prototype.adjustMapObject=function(mapObj,player,map){if(mapObj.applyGravityAndFriction){if(player.x!==0&&player.x!==Game.VIEWPORT_WIDTH-player.width){mapObj.screenX=mapObj.screenX+(player.velocityX*-player.direction);}
mapObj.screenY+=map.gravity;mapObj.screenX=mapObj.screenX+(mapObj.velocityX*mapObj.direction);return mapObj.velocityX-=map.friction;}else{mapObj.screenX=mapObj.mapX-map.x;return mapObj.screenY=mapObj.mapY-map.y;}};PhysicsEngine.prototype.manageNis=function(nis,player,map){var Object,pGoals,prop,target,value,_i,_j,_len,_len2;prop={};value=0;pGoals=nis.nisGoal.playerGoals;for(_i=0,_len=pGoals.length;_i<_len;_i++){prop=pGoals[_i];value=pGoals[prop];target=(value-player[prop])/(nis.nisGoal.duration-nis.frame);player.direction=target<0?-1:1;player[prop]+=target;player.frame++;}
({mGoals:Object=nis.nisGoal.mapGoals});for(_j=0,_len2=mGoals.length;_j<_len2;_j++){prop=mGoals[_j];value=mGoals[prop];map[prop]+=(value-map[prop])/(nis.nisGoal.duration-nis.frame);this.adjustMapVerically(map,player);}
nis.frame++;return nis.frame>=nis.nisGoal.duration;};return PhysicsEngine;})();PhysicsEngine.prototype.__defineGetter__("gravity",function(){return this._gravity;});PhysicsEngine.prototype.__defineSetter__("gravity",function(val){return this._gravity=val;});PhysicsEngine.prototype.__defineGetter__("friction",function(){return this._friction;});PhysicsEngine.prototype.__defineSetter__("friction",function(val){return this._friction=val;});Player=(function(_super){var _actions,_applyGravityAndFriction,_collisionCoefficient,_collisionLeft,_collisionRight,_composite,_compositePoint,_damage,_emitter,_floor,_frame,_health,_isBusy,_isDead,_jumpLeft,_jumpRight,_mapBoundsMax,_mapBoundsMin,_mapX,_mapY,_maxVelocityX,_maxVelocityY,_minVelocity,_moveLeft,_moveRight,_point,_previousState,_screenX,_screenY,_showBounds,_showCollisionRect,_state,_thresholdX,_thresholdY,_uniqueID;__extends(Player,_super);function Player(name){this.name=name;this.x=0;this.y=0;this.width=0;this.height=0;this.point={};}
_showBounds=false;_showCollisionRect=false;_isBusy=false;_isDead=false;_applyGravityAndFriction=true;_mapX=0;_mapY=0;_mapBoundsMin=0;_mapBoundsMax=0;_screenX=0;_screenY=0;_frame=0;_maxVelocityX=15;_maxVelocityY=26;_collisionCoefficient=0;_minVelocity=0;_floor=0;_thresholdX=0;_thresholdY=0;_health=100;_damage=10;_uniqueID="";_actions=[];_moveRight={};_moveLeft={};_collisionRight={};_collisionLeft={};_jumpRight={};_jumpLeft={};_state={};_previousState={};_composite={};_compositePoint={};_emitter={};_point={};Player.prototype.initialize=function(){Player.__super__.initialize.apply(this,arguments);this.y=_floor=Game.prototype.VIEWPORT_HEIGHT-(this.asset.height-this.cellHeight);this.mapBoundsMin=Game.prototype.VIEWPORT_WIDTH*.15;this.mapBoundsMax=(Game.prototype.VIEWPORT_WIDTH*.85)-this.width;return this.updateInherentStates();};Player.prototype.updateInherentStates=function(action){if(action===void 0){_moveRight=new State(Math.round(this.asset.width/this.cellWidth)-1,0,true,"moveRight");_moveLeft=new State(Math.round(this.asset.width/this.cellWidth)-1,1,true,"moveLeft");_collisionRight=new State(Math.round(this.asset.width/this.cellHeight)-1,2,false,"collisionRight");_collisionLeft=new State(Math.round(this.asset.width/this.cellHeight)-1,3,false,"collsionLeft");_jumpRight=new State(Math.round(this.asset.width/this.cellWidth)-1,0,true,"jumpRight");_jumpLeft=new State(Math.round(this.asset.width/this.cellWidth)-1,1,true,"jumpLeft");}else{_moveRight=this.assignActionState(action.stateRight,_moveRight);_moveLeft=this.assignActionState(action.stateLeft,_moveLeft);_collisionRight=this.assignActionState(action.stateCollisionRight,_collisionRight);_collisionLeft=this.assignActionState(action.stateCollisionLeft,_collisionLeft);_jumpRight=this.assignActionState(action.stateJumpRight,_jumpRight);_jumpLeft=this.assignActionState(action.stateJumpLeft,_jumpLeft);}
_previousState=_moveRight;return _state=_moveRight;};Player.prototype.assignActionState=function(state,inherent){if(state){return state;}else{return inherent;}};Player.prototype.getCustomActionForKey=function(keyCode){return this.actions[keyCode];};Player.prototype.setCustomActionForKey=function(keyCode,action){return this.actions[keyCode]=action;};return Player;})(RenderObject);Player.prototype.__defineGetter__("bitmapData",function(){var ctx,keyFrame,row;this.workbench.width=this._asset.width;this.workbench.height=this._asset.height;ctx=workbench.getContext('2d');keyFrame=Math.floor(this._frame)*this._cellWidth;ctx.drawImage(this._asset,keyFrame,0);keyFrame=Math.floor(_frame)*cellWidth;return row=_state.row*cellHeight;});Player.prototype.__defineSetter__("x",function(val){if((val>=0)&&(val<=(Game.prototype.VIEWPORT_WIDTH-this.width))){return this._x=val;}else if(val<0){return this._x=0;}else if(val>0){return this._x=Game.prototype.VIEWPORT_WIDTH-this.width;}});Player.prototype.__defineSetter__("y",function(val){if(val>=(Game.prototype.VIEWPORT_HEIGHT-this.cellHeight)){this._y=Game.prototype.VIEWPORT_HEIGHT-this.cellHeight;return;}
return this._y=val;});Player.prototype.__defineSetter__("direction",function(val){this._direction=val;return this.state=this.direction===-1?this._moveLeft:this._moveRight;});Player.prototype.__defineGetter__("frame",function(){return this._frame;});Player.prototype.__defineSetter__("frame",function(val){if(val>=this._state.duration){if(!this._state.persistent){this._state=this._previousState;this.frameBuffer=this._state.frameBuffer;this._isBusy=false;}
this._frame=0;return;}
return this._frame=this._frame===0||val===0?val:val-this.frameBuffer;});Player.prototype.__defineSetter__("velocityX",function(val){if(val<=this._maxVelocityX&&val>=this._minVelocity){return this._velocityX=val;}else if(val<=this._minVelocity){return this._velocityX=0;}});Player.prototype.__defineGetter__("vOrigin",function(){var val;val=0;if(this.direction===-1){val=this.width+this.x;}else if(this.direction===1){val=this.x;}
return val;});Player.prototype.__defineGetter__("hOrigin",function(){var val;val=0;if(this.direction===-1){val=this.x;}else if(this.direction===1){val=this.width+this.x;}
return val;});Player.prototype.__defineGetter__("state",function(){return this._state;});Player.prototype.__defineSetter__("state",function(val){if(this._isBusy||(this._state.id===val.id))return;if((val.id===this._jumpRight.id)||(val.id===this._jumpLeft.id)){this.velocityY=this._maxVelocityY;}
this._frame=0;this.frameBuffer=val.frameBuffer;this._previousState=this._state;return this._state=val;});Player.prototype.__defineGetter__("health",function(){return this._health;});Player.prototype.__defineSetter__("health",function(val){this._health=val;if(this._health<=0)return this._isDead=true;});Player.prototype.__defineGetter__("mapX",function(){return this._mapX;});Player.prototype.__defineSetter__("mapX",function(val){return this._mapX=val;});Player.prototype.__defineGetter__("mapY",function(){return this._mapY;});Player.prototype.__defineSetter__("mapY",function(val){return this._mapY=val;});Player.prototype.__defineGetter__("mapBoundsMin",function(){return this._mapBoundsMin;});Player.prototype.__defineSetter__("mapBoundsMin",function(val){return this._mapBoundsMin=val;});Player.prototype.__defineGetter__("mapBoundsMax",function(){return this._mapBoundsMax;});Player.prototype.__defineSetter__("mapBoundsMax",function(val){return this._mapBoundsMax=val;});Player.prototype.__defineGetter__("screenX",function(){return this._screenX;});Player.prototype.__defineSetter__("screenX",function(val){return this._screenX=val;});Player.prototype.__defineGetter__("screenY",function(){return this._screenY;});Player.prototype.__defineSetter__("screenY",function(val){return this._screenY=val;});Player.prototype.__defineGetter__("floor",function(){return this._floor;});Player.prototype.__defineSetter__("floor",function(val){return this._floor=val;});Player.prototype.__defineGetter__("collisionCoefficient",function(){return this._collisionCoefficient;});Player.prototype.__defineSetter__("collisionCoefficient,",function(val){return this._collisionCoefficient=val;});Player.prototype.__defineGetter__("maxVelocityX",function(){return this._maxVelocityX;});Player.prototype.__defineSetter__("maxVelocityX",function(val){return this._maxVelocityX=val;});Player.prototype.__defineGetter__("maxVelocityY",function(){return this._maxVelocityY;});Player.prototype.__defineSetter__("maxVelocityY",function(val){return this._maxVelocityY=val;});Player.prototype.__defineGetter__("applyGravityAndFriction",function(){return this._applyGravityAndFriction;});Player.prototype.__defineSetter__("applyGravityAndFriction",function(val){return this._applyGravityAndFriction=val;});Player.prototype.__defineGetter__("showBounds",function(){return this._showBounds;});Player.prototype.__defineSetter__("showBounds",function(val){return this._showBounds=val;});Player.prototype.__defineGetter__("showCollisionRect",function(){return this._showCollisionRect;});Player.prototype.__defineSetter__("showCollisionRect",function(val){return this._showCollisionRect=val;});Player.prototype.__defineGetter__("thresholdX",function(){return this._thresholdX;});Player.prototype.__defineSetter__("thresholdX",function(val){if(val>(this.width*.5)){console.log("You cant set a threshold this high. There would be no collision area.");}
return this._thresholdX=val;});Player.prototype.__defineGetter__("thresholdY",function(){return this._thresholdY;});Player.prototype.__defineSetter__("thresholdY",function(val){if(val>(this.height*.5)){console.log("You cant set a threshold this high. There would be no collision area.");}
return this._thresholdY=val;});Player.prototype.__defineGetter__("damage",function(){return this._damage;});Player.prototype.__defineSetter__("damage",function(val){return this._damage=val;});Player.prototype.__defineGetter__("isDead",function(){return this._isDead;});Player.prototype.__defineGetter__("isBusy",function(){return this._isBusy;});Player.prototype.__defineSetter__("isBusy",function(val){return this._isBusy=val;});Player.prototype.__defineGetter__("collisionRect",function(){return this["new"](Rectangle(this.x+this.thresholdX,this.y+this.thresholdY,this.width-(this.thresholdX*2),this.height-(this.thresholdY*2)));});Player.prototype.__defineGetter__("moveLeft",function(){return this._moveLeft;});Player.prototype.__defineGetter__("moveRight",function(){return this._moveRight;});Player.prototype.__defineGetter__("jumpRight",function(){return this._jumpRight;});Player.prototype.__defineGetter__("jumpLeft",function(){return this._jumpLeft;});Player.prototype.__defineGetter__("collisionLeft",function(){return this._collisionLeft;});Player.prototype.__defineGetter__("collisionRight",function(){return this._collisionRight;});Player.prototype.__defineGetter__("composite",function(){return this._composite;});Player.prototype.__defineSetter__("composite",function(val){return this._composite=val;});Player.prototype.__defineGetter__("compositePoint",function(){return new Point(this.x+this.composite.x,this.y+this.composite.y);});Player.prototype.__defineSetter__("compositePoint",function(val){return this._compositePoint=val;});Player.prototype.__defineGetter__("emitter",function(){return this._emitter;});Player.prototype.__defineSetter__("emitter",function(val){return this._emitter=val;});Player.prototype.__defineGetter__("uniqueID",function(){return this._uniqueID;});Player.prototype.__defineSetter__("uniqueID",function(val){return this._uniqueID=val;});Point=(function(){var _x,_y;function Point(_x,_y){this._x=_x;this._y=_y;}
_x=0;_y=0;return Point;})();Point.prototype.__defineGetter__("x",function(){return this._x;});Point.prototype.__defineSetter__("x",function(val){return this._x=val;});Point.prototype.__defineGetter__("y",function(){return this._y;});Point.prototype.__defineSetter__("y",function(val){return this._y=val;});Rectangle=(function(){var _height,_width,_x,_y;function Rectangle(_x,_y,_width,_height){this._x=_x;this._y=_y;this._width=_width;this._height=_height;}
_x=0;_y=0;_width=0;_height=0;return Rectangle;})();Rectangle.prototype.__defineGetter__("x",function(){return this._x;});Rectangle.prototype.__defineSetter__("x",function(val){return this._x=val;});Rectangle.prototype.__defineGetter__("y",function(){return this._y;});Rectangle.prototype.__defineSetter__("y",function(val){return this._y=val;});Rectangle.prototype.__defineGetter__("width",function(){return this._width;});Rectangle.prototype.__defineSetter__("width",function(val){return this._width=val;});Rectangle.prototype.__defineGetter__("height",function(){return this._height;});Rectangle.prototype.__defineSetter__("height",function(val){return this._height=val;});RenderEngine=(function(){var _actionObjects,_collisionEngine,_map,_nis,_physicsEngine,_player,_scrn,_soundEngine;function RenderEngine(name){this.name=name;}
_actionObjects=[];_scrn={};_map={};_player={};_nis={};_soundEngine={};_collisionEngine={};_physicsEngine={};RenderEngine.prototype.render=function(input){var action,enemy,mapObj,_i,_j,_k,_len,_len2,_len3,_ref,_ref2;if(this.nis){this.manageNIS(this.nis,input);return;}
this.manageMap(input);this.paint(this.map,this.map.point);this.map.manageElements(Map.prototype.MANAGE_ENEMIES);_ref=this.map.activeEnemies;for(_i=0,_len=_ref.length;_i<_len;_i++){enemy=_ref[_i];this.manageEnemy(enemy);this.paint(enemy,enemy.point);}
for(_j=0,_len2=_actionObjects.length;_j<_len2;_j++){action=_actionObjects[_j];if(this.actionIsIdle(action))continue;this.manageAction(action);this.paint(action,action.point);}
_ref2=this.map.activeMapObjects;for(_k=0,_len3=_ref2.length;_k<_len3;_k++){mapObj=_ref2[_k];mapObj.frame++;this.manageMapObject(mapObj);this.paint(mapObj,mapObj.point);}
this.map.manageElements(Map.prototype.MANAGE_MAP_OBJECTS);this.paint(this.player,this.player.point);if(this.player.composite!==void 0){this.player.composite.frame++;this.paint(this.player.composite,this.player.compositePoint);}
if(this.player.emitter!==void 0&&this.player.emitter.hasParticles){this.player.emitter.frame++;this.paint(this.player.emitter,this.player.point);}
return Game.prototype.instance.notifySubscribers(this.map,this.player,this.actionObjects);};RenderEngine.prototype.paint=function(obj,point){var ctxMain,pixels;ctxMain=this.scrn.getContext('2d');pixels=obj.bitmapData;return ctxMain.putImageData(pixels,0,0);};RenderEngine.prototype.manageMap=function(input){this.soundEngine.checkPlayback(this.map);return this.physicsEngine.adjustMapVerically(this.map,this.player);};RenderEngine.prototype.dispose=function(){_actionObjects=void 0;this.scrn=void 0;this.map.dispose();this.map=void 0;this.player.dispose();this.player=void 0;this.soundEngine=void 0;return this.collisionEngine=void 0;};return RenderEngine;})();RenderEngine.prototype.__defineGetter__("scrn",function(){return this._scrn;});RenderEngine.prototype.__defineSetter__("scrn",function(val){return this._scrn=val;});RenderEngine.prototype.__defineGetter__("map",function(){return this._map;});RenderEngine.prototype.__defineSetter__("map",function(val){if(this._map)this.soundEngine.removeSound(this._map.sound);this.collisionEngine.map=val;return this._map=val;});RenderEngine.prototype.__defineGetter__("player",function(){return this._player;});RenderEngine.prototype.__defineSetter__("player",function(val){this.collisionEngine.player=val;return this._player=val;});RenderEngine.prototype.__defineGetter__("soundEngine",function(){return this._soundEngine;});RenderEngine.prototype.__defineSetter__("soundEngine",function(val){return this._soundEngine=val;});RenderEngine.prototype.__defineGetter__("collisionEngine",function(){return this._collisionEngine;});RenderEngine.prototype.__defineSetter__("collisionEngine",function(val){return this._collisionEngine=val;});RenderEngine.prototype.__defineGetter__("physicsEngine",function(){return this._physicsEngine;});RenderEngine.prototype.__defineSetter__("physicsEngine",function(val){this._physicsEngine=val;return this.collisionEngine.physicsEngine=val;});RenderObject=(function(){var _asset,_assetClass,_cellHeight,_cellWidth,_direction,_duration,_easeCoefficient,_frame,_frameBuffer,_height,_index,_lifeSpan,_transparency,_velocityX,_velocityY,_width,_workbench,_x,_y;function RenderObject(name){this.name=name;this.x=0;this.y=0;}
_transparency=false;_workbench={};_x=0;_y=0;_width=0;_height=0;_duration=0;_frame=0;_frameBuffer=0;_velocityX=0;_velocityY=0;_easeCoefficient=0;_index=0;_lifeSpan=0;_cellWidth=0;_cellHeight=0;_direction=1;_assetClass="";_asset={};RenderObject.prototype.initialize=function(){if((void 0!==this.assetClass)&&(0!==this.cellHeight)&&(0!==this.cellWidth)){this._asset=new Image();this._asset.src=this.assetClass;return this.workbench=document.createElement("canvas");}else{return console.log("Set a cellwidth , cellheight , and assetClass before calling initialize.");}};RenderObject.prototype.dispose=function(){_assetClass=void 0;return _asset=void 0;};return RenderObject;})();RenderObject.prototype.__defineGetter__("bitmapData",function(){var ctx,keyFrame;this.workbench.width=this._asset.width;this.workbench.height=this._asset.height;ctx=workbench.getContext('2d');keyFrame=Math.floor(this._frame)*this._cellWidth;ctx.drawImage(this._asset,keyFrame,0);return ctx.getImageData(0,0,this.width,this.height);});RenderObject.prototype.__defineGetter__("x",function(){return this._x;});RenderObject.prototype.__defineSetter__("x",function(val){return this._x=val;});RenderObject.prototype.__defineGetter__("y",function(){return this._y;});RenderObject.prototype.__defineSetter__("y",function(val){return this._y=val;});RenderObject.prototype.__defineGetter__("width",function(){return this.cellWidth;});RenderObject.prototype.__defineGetter__("height",function(){return this.cellHeight;});RenderObject.prototype.__defineGetter__("cellWidth",function(){return this._cellWidth;});RenderObject.prototype.__defineSetter__("cellWidth",function(val){return this._cellWidth=val;});RenderObject.prototype.__defineGetter__("cellHeight",function(){return this._cellHeight;});RenderObject.prototype.__defineSetter__("cellHeight",function(val){return this._cellHeight=val;});RenderObject.prototype.__defineSetter__("velocityX",function(val){return this._velocityX=val;});RenderObject.prototype.__defineGetter__("velocityX",function(){return this._velocityX;});RenderObject.prototype.__defineSetter__("velocityY",function(val){return this._velocityY=val;});RenderObject.prototype.__defineGetter__("velocityY",function(){return this._velocityY;});RenderObject.prototype.__defineSetter__("direction",function(val){return this._direction=val;});RenderObject.prototype.__defineGetter__("direction",function(){return this._direction;});RenderObject.prototype.__defineSetter__("easeCoefficient",function(val){return this._easeCoefficient=val;});RenderObject.prototype.__defineGetter__("easeCoefficient",function(){return this._easeCoefficient;});RenderObject.prototype.__defineSetter__("frame",function(val){return this._frame=val;});RenderObject.prototype.__defineGetter__("frame",function(){return this._frame;});RenderObject.prototype.__defineSetter__("frameBuffer",function(val){return this._frameBuffer=val;});RenderObject.prototype.__defineGetter__("frameBuffer",function(){return this._frameBuffer;});RenderObject.prototype.__defineSetter__("duration",function(val){return this._duration=val;});RenderObject.prototype.__defineGetter__("duration",function(){return this._duration;});RenderObject.prototype.__defineGetter__("rect",function(){return new Rectangle(0,0,this.width,this.height);});RenderObject.prototype.__defineGetter__("point",function(){return new Point(this.x,this.y);});RenderObject.prototype.__defineSetter__("tranparency",function(val){return this._transparency=val;});RenderObject.prototype.__defineGetter__("transparency",function(){return this._transparency;});RenderObject.prototype.__defineGetter__("asset",function(){return this._asset;});RenderObject.prototype.__defineGetter__("assetClass",function(){return this._assetClass;});RenderObject.prototype.__defineSetter__("assetClass",function(val){return this._assetClass=val;});RenderObject.prototype.__defineGetter__("workbench",function(){return this._workbench;});RenderObject.prototype.__defineSetter__("workbench",function(val){return this._workbench=val;});SoundEngine=(function(){var _activeSounds;function SoundEngine(name){this.name=name;}
_activeSounds=[];SoundEngine.prototype.checkPlayback=function(obj){if(obj===void 0||obj.sound===void 0||_activeSounds[obj.sound])return;return _activeSounds[obj.sound]=obj.sound;};SoundEngine.prototype.removeSound=function(snd){var arr,index;if(_activeSounds[snd]){index=_activeSounds.indexOf(snd,0);arr=_activeSounds.splice(index,1);return arr=void 0;}};return SoundEngine;})();State=(function(){var _duration,_frameBuffer,_id,_persistent,_row;function State(duration,row,persistent,id,frameBuffer){this.duration=duration;this.row=row;this.persistent=persistent;this.id=id;this.frameBuffer=frameBuffer;}
_persistent=true;_duration=0;_row=0;_frameBuffer=0;_id="";return State;})();State.prototype.__defineGetter__("duration",function(){return this._duration;});State.prototype.__defineSetter__("duration",function(val){return this._duration=val;});State.prototype.__defineGetter__("row",function(){return this._row;});State.prototype.__defineSetter__("row",function(val){return this._row=val;});State.prototype.__defineGetter__("persistent",function(){return this._persistent;});State.prototype.__defineSetter__("persistent",function(val){return this._persistent=val;});State.prototype.__defineGetter__("id",function(){return this._id;});State.prototype.__defineSetter__("id",function(val){return this._id=val;});State.prototype.__defineGetter__("frameBuffer",function(){return this._frameBuffer;});State.prototype.__defineSetter__("frameBuffer",function(val){if(val>.9){this._frameBuffer=.9;console.log("A frame buffer greater .9 will result in the frame always being 0.");return;}
return this._frameBuffer=val;});